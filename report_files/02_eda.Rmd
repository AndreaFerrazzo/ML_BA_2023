---
title: "EDA"
output: html_document
date: "2023-04-20"
---

```{r echo=FALSE, message=FALSE}
source(here::here("scripts/setup.R"))
```

# Nutrition EDA

## Structure and summary

```{r}

# Now let's see the structure of our data
str(recipes)

# We have only numerical variables, but in reality just 4 variables could be considered as such. More in particular, "rating", "calories", "protein", "fat" and "sodium" could be considered as such. The other variables should be considered as a categorical variable since they allow only for 0 or 1 values.


# Let's have a different look at the data with the summary function.
recipes %>% 
  select(rating, calories, protein, fat, sodium) %>% 
  dfSummary(style = "grid")

# We can already see for instance that the majority of the values of the variable "rating" are 4.38 (40% of the total). Moreover, we observe that the variables "calories", "protein", "fat" and "sodium" have roughly 20% of missing values.
```

## Visual exploration - Univariate Analysis

### Rating Barplot
```{r}
recipes %>% 
  ggplot(aes(x=as.factor(rating), fill=as.factor(rating) )) +  
  geom_bar( ) +
  scale_fill_manual(values = c("red4", "red3", "orangered", "orange", "gold", "greenyellow", "green3", "green4") ) +
  theme_classic() +
  theme(legend.position="none") +
  labs(x = "Rating", y = "Count", 
       title = "Overview of recipes' ratings")

# As we can see, most of the ratings have value above 3.75
# A zero rating indicates that the recipe has not been evaluated yet.

```

### Calories - Protein - Fat - Sodium  Boxplots
```{r}
recipes_boxplot <- recipes %>%  
  drop_na(calories, protein, fat, sodium) %>% 
  pivot_longer(cols = c(calories, protein, fat, sodium),
               names_to = "nutrition",
               values_to = "n_value") %>% 
  select(ID, nutrition, n_value)

recipes_boxplot %>%
  ggplot( aes(x=nutrition, y=n_value, fill=nutrition)) +
    geom_boxplot() +
    scale_fill_viridis(discrete = TRUE, alpha=0.6, option="A") +
    theme_light() +
    theme(legend.position="none",
          plot.title = element_text(size=11)) +
  ggtitle("Basic boxplot") +
  xlab("") +
  ylab("Value")
  

# We notice that there are values above 10'000'000 which are clearly outliers. We must then discard those values in order to continue with a meaningful analysis. At this stage, from a visual point of view we cannot extract any relevant information.

recipes_boxplot <- recipes_boxplot %>% 
  filter(n_value <= 2500)

recipes_boxplot %>%
  ggplot(aes(x=nutrition, y=n_value, fill=nutrition)) +
    geom_boxplot() +
    scale_fill_viridis(discrete = TRUE, alpha=0.6, option="A") +
    theme_light() +
    theme(legend.position="none",
          plot.title = element_text(size=11)) +
  ggtitle("Basic boxplot") +
  xlab("") +
  ylab("Value")
```

```{r Single Boxplots}
# for (i in nutritional_values){
#   recipes_boxplot %>% 
#     filter(nutrition == i) %>% 
#     ggplot(aes(y=n_value)) +
#     geom_boxplot() +
#     ylim(c(0,2500)) + 
#     labs(x = "", y = i, title = paste("Boxplot of ", i, " Values"))+
#     theme(axis.text.x=element_blank(),
#           axis.ticks.x=element_blank())
# }
recipes_boxplot %>% 
  dfSummary()
recipes_boxplot %>% 
  filter(nutrition == "calories") %>% 
  ggplot(aes(y=n_value)) +
  geom_boxplot() +
  ylim(c(0,2500)) + 
  labs(x = "", y = "Calories", title = "Boxplot of Calories Values")+
  theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank())

recipes_boxplot %>% 
  filter(nutrition == "fat") %>% 
  ggplot(aes(y=n_value)) +
  geom_boxplot() +
  ylim(c(0,150)) + 
  labs(x = "", y = "Fat", title = "Boxplot of Fat Values")

recipes_boxplot %>% 
  filter(nutrition == "protein") %>% 
  ggplot(aes(y=n_value)) +
  geom_boxplot() +
  ylim(c(0,150)) + 
  labs(x = "", y = "Protein", title = "Boxplot of Protein Values")

recipes_boxplot %>% 
  filter(nutrition == "sodium") %>% 
  ggplot(aes(y=n_value)) +
  geom_boxplot() +
  ylim(c(0,2500)) + 
  labs(x = "", y = "Sodium", title = "Boxplot of Sodium Values")
```

### Calories - Protein - Fat - Sodium  Histograms
```{r}
# Calories histogram
recipes %>% 
  filter(calories != "NA") %>% 
  ggplot(aes(x=calories)) +
  geom_histogram(binwidth=3, fill="red3", color="red3", alpha=0.9) +
  ggtitle("Calories Distribution") +
  theme(plot.title = element_text(size=15))

recipes_plot <- recipes %>% 
  filter(calories <= 10000)

recipes_plot %>% 
  ggplot(aes(x=calories)) +
  geom_histogram(binwidth=50, fill="red3", color="red3", alpha=0.9) +
  ggtitle("Calories Distribution") +
  theme(plot.title = element_text(size=15)) +
  scale_x_continuous(breaks=seq(0,10000,1000))

# Most of the recipes have an amount of calories which is below 1500.

```

# Ingredients EDA

Weird thing to check, my ingredient vector is 292 in length, and the ingredients DF is also 292 despite having ID as additional column --> means one ingredient in my vector is not a column name right? But I don't get an error so nut sure what's happening

```{r Feature Engineering}
#Creating a new dataframe with only the recipe and the ingredients
ingredients_df <- recipes %>% 
  select(ID, title, all_of(all_ingredients))

ingredients_df <- ingredients_df %>% 
  mutate(total_ingredients = rowSums(.[,-(1:2)]), total_meat = rowSums(select(., all_of(meat))), total_vegetables = rowSums(select(., all_of(vegetables)))) %>% 
  select(ID, title, total_ingredients, total_meat, total_vegetables, everything())

#checking some stuff about the new ingredients table
ingredients_df %>% 
  select(ID, title, total_ingredients) %>% 
  ggplot(aes(x=total_ingredients)) + 
  geom_histogram(binwidth=1) + geom_vline(aes(xintercept=mean(total_ingredients)),color="blue", linetype="dashed", size=1)
```
